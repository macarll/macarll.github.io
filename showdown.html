<!DOCTYPE html>
<html>
    <head>
        <title>Western Showdown</title>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/phaser/2.0.5/phaser.min.js"></script>
    </head>
    <body>
        <h3>Click to play, click to shoot first after it says DRAW! to win. Don't shoot too early, or you'll lose!</h3>
        <script>
        var gameState;
        var countdownSeconds = 3;
        function doPreload(){
            game.load.baseURL = "http://files.phaser.io.s3.amazonaws.com/codingtips/issue006/assets/";
            game.load.crossOrigin = "anonymous";
            game.load.image("standoff", "standoff.png");
            game.load.audio("fire", "fire.mp3");
        }
        function doCreate(){
            game.standoff = game.add.sprite(0,0);
            game.standoff.loadTexture("standoff");
            game.message = game.add.text(400,400);
            game.message.text = "Click to Play";
            
            game.input.onDown.add(function(){
                if(gameState === "start"){
                    doCountdown();
                    gameState = "countdown";
                } else if(gameState === "countdown"){
                    doTooSoon();
                } else {
                    game.sound.play("fire");
                }
                 
            });
            doStart();
            }
            function doStart(){
                gameState = "start";
            }
            function doCountdown(){
                gameState = "countdown";
                game.message.text = countdownSeconds;
                game.time.events.loop(1000,function(){
                    countdownSeconds = countdownSeconds - 1;
                    game.message.text = countdownSeconds;
                    if(countdownSeconds === 0){
                        doDraw();
                    }
                });
            }
            
            function doDraw(){
                gameState = "draw";
                game.time.events.removeAll();
                game.message.text = "DRAW!";
            }
            
            function doTooSoon(){
                gameState = "tooSoon";
                game.time.events.removeAll();
                game.message.text = "TOO SOON!"
            }
            
            
        
        
            var game = new Phaser.Game(640, 480, Phaser.AUTO, "", {
                preload: doPreload,
                create: doCreate
            });
        </script>
    </body>
</html>